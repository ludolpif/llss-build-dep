#!/bin/sh
#
# This file is part of LLSS.
#
# LLSS is free software: you can redistribute it and/or modify it under the terms of the
# Affero GNU General Public License as published by the Free Software Foundation,
# either version 3 of the License, or (at your option) any later version.
#
# LLSS is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
# without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
# See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with LLSS.
# If not, see <https://www.gnu.org/licenses/>. See LICENSE file at root of this git repo.
#
# Copyright 2025 ludolpif <ludolpif@gmail.com>
#
LOG=configure-build-dep.log
check() {
	cmd="$1"; shift
	echo "${PS4}$cmd $*" >>$LOG
	err=$($cmd $* 2>&1 >>$LOG)
      	res=$?
	if [ $res -eq 127 ]; then
		echo "You need $cmd in PATH" >&2
	fi
	if [ $res -ne 0 ]; then
		echo "${PS4}$cmd $*"
		echo $err >&2
	fi
	printf "%s%-72s FOUND\n" "$PS4" "$cmd"
}
date --rfc-3339=seconds > $LOG
check uname --version
check curl --version
check git --version
check make --version
check gcc --version
check ar --version
check pkg-config --version
check install --version

check=lib/ui/dear_bindings_generated/backends/dcimgui_impl_sdlgpu3.h
[ -f $check ] || echo "$check file absent, you need to call './get --sources' first" >&2

if ! pkg-config sdl3 --cflags > /dev/null; then
	cat <<"EOT"
pkg-config sdl3 --cflags have failed
On linux, you just need to install libsdl3-dev (debian) or sdl3-devel (redhat) package.
EOT
fi

uname -a >> $LOG
cat /etc/os-release >>$LOG
/lib/x86_64-linux-gnu/libc.so.? >> $LOG
date --rfc-3339=seconds >> $LOG
# So far this ./configure output no files, it just make sanity checks for 'make' step
